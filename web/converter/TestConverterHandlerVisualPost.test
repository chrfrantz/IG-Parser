<!DOCTYPE html>
<html lang="en">


<style>

    .node circle {
        fill: #fff;
        stroke: steelblue;
        stroke-width: 3px;
        r: 16;
    }

    .node text {
        font: 12px sans-serif;
        font-weight: bold;
    }

    .link {
        fill: none;
        stroke: #ccc;
        stroke-width: 2px;
    }

    .link text {
        font: 12px sans-serif;
    }

    .link.text2 {
        font: 20px sans-serif;
    }

</style>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IG Parser</title>
    <link rel="icon" type="image/x-icon" href="/css/favicon.ico">
    <link rel="shortcut icon" type="image/x-icon" href="/css/favicon.ico">
    <link rel="stylesheet" href="/css/default.css">
    
    <script src="/libraries/ace/ace.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>
<script>

    

    function CopyToClipboard(containerid) {
        if (document.selection) {
            let range = document.body.createTextRange();
            range.moveToElementText(document.getElementById(containerid));
            range.select().createTextRange();
            document.execCommand("copy");
        } else if (window.getSelection) {
            let range = document.createRange();
            range.selectNode(document.getElementById(containerid));
            window.getSelection().addRange(range);
            let res = document.execCommand("copy");
            if (res !== true) {
                alert("Text-to-Clipboard copying failed. Please select output manually and copy via keyboard.")
            }
        }
    }

    

    function check(target) {
        let offset = 0
        target.style.height = 'auto';
        target.style.height = target.scrollHeight + offset + 'px';
    }
</script>

<p>&nbsp;</p>
<p>&nbsp;</p>
<h1><a style="text-decoration:none" href="https://github.com/chrfrantz/IG-Parser" target="_blank">IG Parser</a></h1>
<h2>A Parser for Institutional Statements encoded in the <a href="/help/" target="_blank">IG Script Notation</a> of the <a href="https://newinstitutionalgrammar.org" target="_blank">Institutional Grammar 2.0</a></h2>
<p>&nbsp;</p>
<p>&nbsp;</p>
<div class="form">
    <form method="POST">
        
        <span data-text="This entry field is for optional use. You can paste the original statement here as a reference while encoding it in the &#39;Encoded Statement&#39; field." class="tooltip">Original Statement:</span>
        <textarea id="rawStmt" name="rawStmt" onfocusin="check(this)" onkeyup="check(this);saveFormContent()" onpaste="check(this);saveFormContent()">Regional Managers, on behalf of the Secretary, may review, reward, or sanction approved certified production and handling operations and accredited certifying agents for compliance with the Act or regulations in this part, under the condition that Operations were non-compliant or violated organic farming provisions and Manager has concluded investigation.</textarea><br />
        
        <span data-text="Click to open a separate help page explaining the IG Script syntax (opens new tab)." class="tooltip"><a href="/help/" target="_blank">Encoded Statement: (?)</a></span>
        
        <div id="editor" name="editor" onkeyup="copyEditorContentToTextArea();saveFormContent()" onpaste="copyEditorContentToTextArea();saveFormContent()">A,p(Regional) A[role=enforcer,type=animate](Managers), Cex(on behalf of the Secretary), D[stringency=permissive](may) I[act=performance]((review [AND] (reward [XOR] sanction))) Bdir,p(approved) Bdir1,p(certified) Bdir1[role=monitored,type=animate](production [operations]) and Bdir[role=monitored,type=animate](handling operations) and Bdir2,p(accredited) Bdir2[role=monitor,type=animate](certifying agents) Cex[ctx=purpose](for compliance with the (Act or [XOR] regulations in this part)) under the condition that {Cac[state]{A[role=monitored,type=animate](Operations) I[act=violate](were (non-compliant [OR] violated)) Bdir[type=inanimate](organic farming provisions)} [AND] Cac[state]{A[role=enforcer,type=animate](Manager) I[act=terminate](has concluded) Bdir[type=activity](investigation)}}.</div>
        <script>
            let editor = ace.edit("editor");
            editor.session.setMode("ace/mode/text"); 
            
            editor.setOption("showLineNumbers", true); 
            editor.setOption("wrap", true); 
            editor.setOption("showGutter", true); 
            editor.setOption("showPrintMargin", false); 
            editor.setOption("behavioursEnabled", false);
            editor.setOption("cursorStyle", "ace");
            editor.setOption("fontFamily", "monospace"); 
            editor.setOption("fontSize", 16); 
            editor.setOption("minLines", 5); 
            editor.setOption("maxLines", 30); 

            

            function copyEditorContentToTextArea() {
                let ta = document.getElementById("codedStmt");
                
                ta.value = editor.getValue();
            }

            

            

            function saveFormContent() {
                
                let content = editor.getValue();
                localStorage.setItem("codedStmt", content);
                

                
                saveValue("rawStmt")

                
                

                

                
                saveValue("stmtId")

                
                saveCheckbox("igExtended")

                
                saveCheckbox("annotations")

                
                saveCheckbox("includeHeaders")

                
                saveValue("outputType")

                

                
                saveCheckbox("dov")

                
                saveCheckbox("propertyTree")

                
                saveCheckbox("binaryTree")

                
                saveCheckbox("actCondTop")

                
                saveValue("canvasHeight")

                
                saveValue("canvasWidth")

            }

            

            function saveCheckbox(fieldId) {
                let tmpField = document.getElementById(fieldId);
                if(tmpField != null) {
                    localStorage.setItem(fieldId, tmpField.checked);
                    
                }
            }

            

            function saveValue(fieldId) {
                let tmpField = document.getElementById(fieldId);
                if(tmpField != null) {
                    localStorage.setItem(fieldId, tmpField.value);
                    
                }
            }

            

            function loadFormContent() {
                
                if  false  === false {
                    
                    if (localStorage.getItem("codedStmt") != null) {
                        
                        let content = localStorage.getItem("codedStmt");
                        editor.setValue(content);
                        
                        copyEditorContentToTextArea();
                        
                    }

                    
                    loadValue("rawStmt")

                }
                

                
                loadValue("stmtId")

                
                loadCheckbox("igExtended")

                
                loadCheckbox("annotations")

                
                loadCheckbox("includeHeaders")

                
                loadValue("outputType")

                

                
                loadCheckbox("dov")

                
                loadCheckbox("propertyTree")

                
                loadCheckbox("binaryTree")

                
                loadCheckbox("actCondTop")

                
                loadValue("canvasHeight")

                
                loadValue("canvasWidth")

            }

            

            function loadValue(fieldId) {
                if(localStorage.getItem(fieldId) != null && document.getElementById(fieldId) != null) {
                    document.getElementById(fieldId).value = localStorage.getItem(fieldId);
                }
            }

            

            function loadCheckbox(fieldId) {
                if(localStorage.getItem(fieldId) != null && document.getElementById(fieldId) != null) {
                    let content = localStorage.getItem(fieldId);
                    if(content === "true") {
                        document.getElementById(fieldId).checked = true;
                        
                    }
                    if(content === "false") {
                        document.getElementById(fieldId).checked = false;
                        
                    }
                    
                }
            }

            

            function resetContent() {
                
                editor.setValue("A,p(Regional) A[role=enforcer,type=animate](Managers), Cex(on behalf of the Secretary), D[stringency=permissive](may) I[act=performance](review [AND] (reward [XOR] sanction)) Bdir,p(approved) Bdir1,p(certified) Bdir1[role=monitored,type=animate](production [operations]) and Bdir[role=monitored,type=animate](handling operations) and Bdir2,p(accredited) Bdir2[role=monitor,type=animate](certifying agents) Cex[ctx=purpose](for compliance with the (Act [XOR] regulations in this part)) under the condition that Cac{Cac[state]{A[role=monitored,type=animate](Operations) I[act=violate](were non-compliant [OR] violated) Bdir[type=inanimate](organic farming provisions)} [AND] Cac[state]{A[role=enforcer,type=animate](Manager) I[act=terminate](has concluded) Bdir[type=activity](investigation)}}.")
                
                copyEditorContentToTextArea();

                
                document.getElementById("rawStmt").value = "Regional Managers, on behalf of the Secretary, may review, reward, or sanction approved certified production and handling operations and accredited certifying agents for compliance with the Act or regulations in this part, under the condition that Operations were non-compliant or violated organic farming provisions and Manager has concluded investigation.";

                
                if(document.getElementById("stmtId") != null) {
                    document.getElementById("stmtId").value = "123";
                }

                
                
                localStorage.setItem("stmtId", "123");
                
                saveFormContent();
            }

            

            function resetCanvas() {

                
                if(document.getElementById("canvasHeight") != null) {
                    document.getElementById("canvasHeight").value =  2000 ;
                }

                
                if(document.getElementById("canvasWidth") != null) {
                    document.getElementById("canvasWidth").value =  4000 ;
                }

                
                saveFormContent();
            }

            
            window.onload = (event) => {
                loadFormContent();
            };
        </script>

        
        <textarea id="codedStmt" name="codedStmt" onfocusin="check(this)" onkeyup="check(this)" style="display:none;">A,p(Regional) A[role=enforcer,type=animate](Managers), Cex(on behalf of the Secretary), D[stringency=permissive](may) I[act=performance]((review [AND] (reward [XOR] sanction))) Bdir,p(approved) Bdir1,p(certified) Bdir1[role=monitored,type=animate](production [operations]) and Bdir[role=monitored,type=animate](handling operations) and Bdir2,p(accredited) Bdir2[role=monitor,type=animate](certifying agents) Cex[ctx=purpose](for compliance with the (Act or [XOR] regulations in this part)) under the condition that {Cac[state]{A[role=monitored,type=animate](Operations) I[act=violate](were (non-compliant [OR] violated)) Bdir[type=inanimate](organic farming provisions)} [AND] Cac[state]{A[role=enforcer,type=animate](Manager) I[act=terminate](has concluded) Bdir[type=activity](investigation)}}.</textarea><br />
        
        <span data-text="Resets the 'Original Statement' and 'Encoded Statement' fields to the original example content. Note that this will overwrite the current content (e.g., statements you coded)." class="tooltip"><a href="" onclick="resetContent()">Reset to default statement example</a></span><br /><br />



<span data-text=""><a href="/" onclick="saveFormContent()">Switch to tabular version of IG Parser</a></span><br /><br />

<span data-text="This section includes specific customizations for the output generation, which affect the generated output. Where larger numbers of statements are encoded for analytical purposes, ensure the consistent parameterization for all generated statements." class="tooltip">Parameters:</span>

<input id="annotations" name="annotations" type="checkbox" unchecked /><label for="annotations">Include IG Logico annotations in output (default: off)</label>
<input id="dov" name="dov" type="checkbox" unchecked /><label for="dov">Include Degree of Variability (accumulated toward root node) in output (default: off)</label>
<input id="propertyTree" name="propertyTree" type="checkbox" checked /><label for="propertyTree">Embed component properties in tree structure (as opposed to capturing those in labels associated with component) (default: on)</label>
<input id="binaryTree" name="binaryTree" type="checkbox" unchecked /><label for="binaryTree">Print binary logical tree structure (decompose all logical linkages for given components in binary form) (default: off)</label>
<input id="actCondTop" name="actCondTop" type="checkbox" unchecked /><label for="actCondTop">Print activation conditions node (if present) as first node in output (default: off)</label>
Height of output canvas (in pixels): <input id="canvasHeight" name="canvasHeight" type="number" value="2000">
Width of output canvas (in pixels): <input id="canvasWidth" name="canvasWidth" type="number" value="4000">

<span data-text="Resets canvas height and width to default values." class="tooltip"><a href="" onclick="resetCanvas()">Reset canvas dimensions</a></span><br /><br />

<input value="Generate visual output" onclick="saveFormContent()" type="submit">



<p>Version: 0.2</p>

</form>
</div>



<script src="/libraries/d3.v7.min.js"></script>
<script>

    
    var colorPropertyNodes = "lightgreen";

    
    var colorCollapsedNestedNodes = "lightsalmon";

    
    var colorCollapsedNonNestedNodes = "lightsteelblue";

    
    var colorFillLeafNodes = "#fff";

    
    var colorFirstLevel = "sienna";
    var colorSecondLevel = "sandybrown";
    var colorThirdLevel = "tan";
    var colorFourthLevel = "peachpuff";
    var colorFifthLevel = "wheat";
    var colorHigherLevel = "linen";

    
    var treeData = JSON.parse("{\"name\": \"AND\",\n\"children\": [{\n\"name\": \"\",\n\"level\": 1, \n\"children\": [\n{\"name\": \"Managers\", \"comp\": \"A\", \"level\": 1, \"pos\": \"b\", \"children\": [{\"name\": \"Regional\", \"comp\": \"A,p\", \"level\": 1}]},\n{\"name\": \"may\", \"comp\": \"D\", \"level\": 1},\n{\"name\": \"AND\",\n\"children\": [{\"name\": \"review\", \"comp\": \"I\", \"level\": 1},\n{\"name\": \"XOR\",\n\"children\": [{\"name\": \"reward\", \"comp\": \"I\", \"level\": 1},\n{\"name\": \"sanction\", \"comp\": \"I\", \"level\": 1}], \"comp\": \"I\", \"level\": 1}], \"comp\": \"I\", \"level\": 1},\n{\"name\": \"bAND\",\n\"children\": [{\"name\": \"production [operations]\", \"comp\": \"Bdir\", \"level\": 1, \"pos\": \"b\", \"children\": [{\"name\": \"approved\", \"comp\": \"Bdir,p\", \"level\": 1}, {\"name\": \"certified\", \"comp\": \"Bdir,p\", \"level\": 1}]}, {\"name\": \"handling operations\", \"comp\": \"Bdir\", \"level\": 1, \"pos\": \"b\", \"children\": [{\"name\": \"approved\", \"comp\": \"Bdir,p\", \"level\": 1}]},\n{\"name\": \"certifying agents\", \"comp\": \"Bdir\", \"level\": 1, \"pos\": \"b\", \"children\": [{\"name\": \"approved\", \"comp\": \"Bdir,p\", \"level\": 1}, {\"name\": \"accredited\", \"comp\": \"Bdir,p\", \"level\": 1}]}], \"comp\": \"Bdir\", \"level\": 1},\n{\n\"name\": \"Cac\",\n\"level\": 2, \n\"children\": [\n{\"name\": \"Operations\", \"comp\": \"A\", \"level\": 2},\n{\"name\": \"OR\",\n\"children\": [{\"name\": \"were non-compliant\", \"comp\": \"I\", \"level\": 2},\n{\"name\": \"were violated\", \"comp\": \"I\", \"level\": 2}], \"comp\": \"I\", \"level\": 2},\n{\"name\": \"organic farming provisions\", \"comp\": \"Bdir\", \"level\": 2}\n]\n},\n{\"name\": \"bAND\",\n\"children\": [{\"name\": \"on behalf of the Secretary\", \"comp\": \"Cex\", \"level\": 1},\n{\"name\": \"XOR\",\n\"children\": [{\"name\": \"for compliance with the Act or\", \"comp\": \"Cex\", \"level\": 1},\n{\"name\": \"for compliance with the regulations in this part\", \"comp\": \"Cex\", \"level\": 1}], \"comp\": \"Cex\", \"level\": 1}], \"comp\": \"Cex\", \"level\": 1}\n]\n},\n{\n\"name\": \"\",\n\"level\": 1, \n\"children\": [\n{\"name\": \"Managers\", \"comp\": \"A\", \"level\": 1, \"pos\": \"b\", \"children\": [{\"name\": \"Regional\", \"comp\": \"A,p\", \"level\": 1}]},\n{\"name\": \"may\", \"comp\": \"D\", \"level\": 1},\n{\"name\": \"AND\",\n\"children\": [{\"name\": \"review\", \"comp\": \"I\", \"level\": 1},\n{\"name\": \"XOR\",\n\"children\": [{\"name\": \"reward\", \"comp\": \"I\", \"level\": 1},\n{\"name\": \"sanction\", \"comp\": \"I\", \"level\": 1}], \"comp\": \"I\", \"level\": 1}], \"comp\": \"I\", \"level\": 1},\n{\"name\": \"bAND\",\n\"children\": [{\"name\": \"production [operations]\", \"comp\": \"Bdir\", \"level\": 1, \"pos\": \"b\", \"children\": [{\"name\": \"approved\", \"comp\": \"Bdir,p\", \"level\": 1}, {\"name\": \"certified\", \"comp\": \"Bdir,p\", \"level\": 1}]}, {\"name\": \"handling operations\", \"comp\": \"Bdir\", \"level\": 1, \"pos\": \"b\", \"children\": [{\"name\": \"approved\", \"comp\": \"Bdir,p\", \"level\": 1}]},\n{\"name\": \"certifying agents\", \"comp\": \"Bdir\", \"level\": 1, \"pos\": \"b\", \"children\": [{\"name\": \"approved\", \"comp\": \"Bdir,p\", \"level\": 1}, {\"name\": \"accredited\", \"comp\": \"Bdir,p\", \"level\": 1}]}], \"comp\": \"Bdir\", \"level\": 1},\n{\n\"name\": \"Cac\",\n\"level\": 2, \n\"children\": [\n{\"name\": \"Manager\", \"comp\": \"A\", \"level\": 2},\n{\"name\": \"has concluded\", \"comp\": \"I\", \"level\": 2},\n{\"name\": \"investigation\", \"comp\": \"Bdir\", \"level\": 2}\n]\n},\n{\"name\": \"bAND\",\n\"children\": [{\"name\": \"on behalf of the Secretary\", \"comp\": \"Cex\", \"level\": 1},\n{\"name\": \"XOR\",\n\"children\": [{\"name\": \"for compliance with the Act or\", \"comp\": \"Cex\", \"level\": 1},\n{\"name\": \"for compliance with the regulations in this part\", \"comp\": \"Cex\", \"level\": 1}], \"comp\": \"Cex\", \"level\": 1}], \"comp\": \"Cex\", \"level\": 1}\n]\n}], \"comp\": \"\", \"level\": 0}");

    
    var margin = {top: 20, right: 90, bottom: 30, left: 90},
        width =  4000  - margin.left - margin.right,
        height =  2000  - margin.top - margin.bottom;

    
    
    
    var svg = d3.select("body").append("svg")
        .attr("width", width + margin.right + margin.left)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", "translate("
            + margin.left + "," + margin.top + ")");

    var i = 0,
        duration = 750,
        root;

    
    var treemap = d3.tree().size([height, width]);

    
    root = d3.hierarchy(treeData, function(d) { return d.children; });
    root.x0 = height / 2;
    root.y0 = 0;

    
    

    update(root);

    
    function collapse(d) {
        if(d.children) {
            d._children = d.children
            d._children.forEach(collapse)
            d.children = null
        }
    }

    
    
    function wrap(text, width, x, y) {
        text.each(function() {
            var text = d3.select(this),
                words = text.text().split(/\s+/).reverse(),
                word,
                line = [],
                lineNumber = 0,
                lineHeight = 1.1, 
                x = text.attr("x"),
                y = text.attr("y"),
                tspan = text.text(null).append("tspan").attr("x", x).attr("y", y);
            while (word = words.pop()) {
                line.push(word);
                tspan.text(line.join(" "));
                if (tspan.node().getComputedTextLength() > width) {
                    line.pop();
                    tspan.text(line.join(" "));
                    line = [word];
                    tspan = text.append("tspan").attr("x", x).attr("y", ++lineNumber * lineHeight + y + "em").text(word);
                }
            }
        });
    }

    function update(source) {

        
        var treeData = treemap(root);

        
        var nodes = treeData.descendants(),
            links = treeData.descendants().slice(1);

        
        
        
        
        nodes.forEach(function(d){ d.y = (d.depth === 0 ? d.depth * 50 : d.depth * 380) });
        

        

        
        var node = svg.selectAll('g.node')
            .data(nodes, function(d) {return d.id || (d.id = ++i); });

        
        var nodeEnter = node.enter().append('g')
            .attr('class', 'node')
            .attr("transform", function(d) {
                return "translate(" + source.y0 + "," + source.x0 + ")";
            })
            .on('click', click);

        
        nodeEnter.append('circle')
            .attr('class', 'node')
            .attr('r', 1e-6)
            .style("stroke", function(d) {
                
                if (d.data.comp && d.data.comp.endsWith(",p")) {
                    return colorPropertyNodes;
                }
                
                if (d.data.level > 0) {
                    
                    switch (d.data.level) {
                        case 1:
                            
                            return colorFirstLevel;
                        case 2:
                            
                            return colorSecondLevel;
                        case 3:
                            
                            return colorThirdLevel;
                        case 4:
                            
                            return colorFourthLevel;
                        case 5:
                            
                            return colorFifthLevel;
                        default:
                            
                            return colorHigherLevel;
                    }
                }
            })
            .style("fill", function(d) {
                if (d._children) {
                    if (d.data.level > 0) {
                        
                        return colorCollapsedNestedNodes;
                    }
                    
                    return colorCollapsedNonNestedNodes;
                } else {
                    
                    return colorFillLeafNodes;
                }
            });

        

        
        nodeEnter.append('text')
            .attr("x", function(d) {
                
                if (d.data.pos === "b") {
                    return -30;
                }
                
                return d.children || d._children ? 12 : 25;
            })
            .attr("y", function (d) {
                
                if (d.data.pos === "b" && d.data.dov != null) {
                    
                    return 45;
                } else if (d.data.pos === "b") {
                    
                    return 35;
                } else {
                    
                    return 0;
                }
            })
            .style("font", function(d) {
                
                if (d.data.name === "bAND" || d.data.name === "wAND") {
                    return "italic 12px Arial";
                } else {
                    
                    if (d.data.pos === "b") {
                        return "bold 12px Arial";
                    }
                    
                    return d.children || d._children ? "normal 12px Arial" : "bold 12px Arial";
                }
            })
            .style("dominant-baseline", "central")
            .attr("text-anchor", function(d) {
                
                if (d.data.pos === "b") {
                    return "begin";
                }
                return d.children || d._children ? "end" : "begin";
            })
            
            .text(function(d) {
                if (d.data.name === "bAND" || d.data.name === "wAND") {
                    return "AND";
                } else {
                    return d.data.name;
                }
              
            }).call(wrap, 300, 0, 0);

        
        var nodeUpdate = nodeEnter.merge(node);

        
        nodeUpdate.transition()
            .duration(duration)
            .attr("transform", function(d) {
                return "translate(" + d.y + "," + d.x + ")";
            });

        
        nodeUpdate.select('circle.node')
            .attr('r', 10)
            .style("stroke", function(d) {
                
                if (d.data.comp && d.data.comp.endsWith(",p")) {
                    return colorPropertyNodes;
                }
                
                if (d.data.level > 0) {
                    
                    switch (d.data.level) {
                        case 1:
                            
                            return colorFirstLevel;
                        case 2:
                            
                            return colorSecondLevel;
                        case 3:
                            
                            return colorThirdLevel;
                        case 4:
                            
                            return colorFourthLevel;
                        case 5:
                            
                            return colorFifthLevel;
                        default:
                            
                            return colorHigherLevel;
                    }
                }
            })
            .style("fill", function(d) {
                if (d._children) {
                    if (d.data.level > 0) {
                        
                        return colorCollapsedNestedNodes;
                    }
                    
                    return colorCollapsedNonNestedNodes;
                } else {
                    
                    return colorFillLeafNodes;
                }
            })
            .attr('cursor', 'pointer');


        
        var nodeExit = node.exit().transition()
            .duration(duration)
            .attr("transform", function(d) {
                return "translate(" + source.y + "," + source.x + ")";
            })
            .remove();

        
        nodeExit.select('circle')
            .attr('r', 1e-6);

        
        nodeExit.select('text')
            .style('fill-opacity', 1e-6);

        

        
        var link = svg.selectAll('path.link')
            .data(links, function(d) { return d.id; });

        
        var linkEnter = link.enter().insert('path', "g")
            .attr("class", "link")
            .attr('d', function(d){
                var o = {x: source.x0, y: source.y0}
                return diagonal(o, o)
            });

        var gGiven = nodeEnter.filter(function (d){
            return d.depth !== 0;
            })
            .append("g")
            .attr("transform","translate(-50)");


        
        gGiven.append("text")
            .attr("dy", ".4em")
            .style("font", "normal 12px Arial")
            .text(function (d) {
                return d.data.comp;
            })
            .attr("text-anchor", function(d) {
                
                return "end";
            })
            .attr("x", "25");


        
        gGiven.append("text")
            .text(function (d){
                if (d.data.prop != null) {
                    return "(" + d.data.prop + ")";
                } else {
                    return "";
                }
            })
            .attr("x", "75")
            .attr("y", "-10");


        
        gGiven.append("text")
            
            .style("font", "italic 12px Arial")
            .text(function (d){
                
                if (d.data.anno != null) {
                    return d.data.anno;
                } else {
                    return "";
                }
            })
            .attr("x", function(d) {
                return 75;
            })
            .attr("y", function(d) {
                
                return d.data.prop != null ? -25 : -12;
            });


        
        gGiven.append("text")
            
            .style("font", "italic 12px Arial")
            .text(function (d){
                
                if (d.data.options != null) {
                    return "Options: " + d.data.options;
                } else {
                    return "";
                }
            })
            .attr("x", 40)
            .attr("y", 55);


        
        gGiven.append("text")
            
            .style("font", "italic 12px Arial")
            .text(function (d){
                
                if (d.data.dov != null) {
                    return "DoV: " + d.data.dov;
                } else {
                    return "";
                }
            })
            
            .attr("x", 20)
            .attr("y", 30);

        
        
        
        
        
        

        


        


        
        var linkUpdate = linkEnter.merge(link);

        
        linkUpdate.transition()
            .duration(duration)
            .attr('d', function(d){ return diagonal(d, d.parent) });

        
        var linkExit = link.exit().transition()
            .duration(duration)
            .attr('d', function(d) {
                let o = {x: source.x, y: source.y}
                return diagonal(o, o)
            })
            .remove();

        
        nodes.forEach(function(d){
            d.x0 = d.x;
            d.y0 = d.y;
        });

        
        function diagonal(s, d) {

            path = `M ${s.y} ${s.x}
            C ${(s.y + d.y) / 2} ${s.x},
              ${(s.y + d.y) / 2} ${d.x},
              ${d.y} ${d.x}`

            return path
        }

        
        function click(event, d) {
            if (d.children) {
                d._children = d.children;
                d.children = null;
            } else {
                d.children = d._children;
                d._children = null;
            }
            update(d);
        }
    }

</script>

</body>
</html>